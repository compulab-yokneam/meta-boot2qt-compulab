From a4d5c179c5dbd3cdfcbe3a369efad129ac6de62e Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 20 Nov 2019 22:38:46 +0200
Subject: [PATCH 3/5] conf: Add bblayer conf per machine

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 .../conf/bblayers.conf.cl-som-imx8.sample          | 56 ++++++++++++++++++++++
 .../conf/bblayers.conf.cl-som-imx8x.sample         | 56 ++++++++++++++++++++++
 .../conf/bblayers.conf.ucm-imx8m-mini.sample       | 56 ++++++++++++++++++++++
 scripts/setup-environment.sh                       |  2 +-
 4 files changed, 169 insertions(+), 1 deletion(-)
 create mode 100644 meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8.sample
 create mode 100644 meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8x.sample
 create mode 100644 meta-boot2qt-distro/conf/bblayers.conf.ucm-imx8m-mini.sample

diff --git a/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8.sample b/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8.sample
new file mode 100644
index 00000000..50724850
--- /dev/null
+++ b/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8.sample
@@ -0,0 +1,56 @@
+############################################################################
+##
+## Copyright (C) 2018 The Qt Company Ltd.
+## Contact: https://www.qt.io/licensing/
+##
+## This file is part of the Boot to Qt meta layer.
+##
+## $QT_BEGIN_LICENSE:GPL$
+## Commercial License Usage
+## Licensees holding valid commercial Qt licenses may use this file in
+## accordance with the commercial license agreement provided with the
+## Software or, alternatively, in accordance with the terms contained in
+## a written agreement between you and The Qt Company. For licensing terms
+## and conditions see https://www.qt.io/terms-conditions. For further
+## information use the contact form at https://www.qt.io/contact-us.
+##
+## GNU General Public License Usage
+## Alternatively, this file may be used under the terms of the GNU
+## General Public License version 3 or (at your option) any later version
+## approved by the KDE Free Qt Foundation. The licenses are as published by
+## the Free Software Foundation and appearing in the file LICENSE.GPL3
+## included in the packaging of this file. Please review the following
+## information to ensure the GNU General Public License requirements will
+## be met: https://www.gnu.org/licenses/gpl-3.0.html.
+##
+## $QT_END_LICENSE$
+##
+############################################################################
+
+# POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf
+# changes incompatibly
+POKY_BBLAYERS_CONF_VERSION = "2"
+
+BBPATH = "${TOPDIR}"
+BBFILES ?= ""
+BSPDIR := "${@os.path.abspath(os.path.dirname(d.getVar('FILE')) + '/../..')}"
+
+BBLAYERS ?= " \
+  ${BSPDIR}/sources/poky/meta \
+  ${BSPDIR}/sources/poky/meta-poky \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-bsp \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-sdk \
+  ${BSPDIR}/sources/meta-freescale \
+  ${BSPDIR}/sources/meta-freescale-3rdparty \
+  ${BSPDIR}/sources/meta-openembedded/meta-oe \
+  ${BSPDIR}/sources/meta-openembedded/meta-python \
+  ${BSPDIR}/sources/meta-openembedded/meta-networking \
+  ${BSPDIR}/sources/meta-openembedded/meta-initramfs \
+  ${BSPDIR}/sources/meta-openembedded/meta-multimedia \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt-distro \
+  ${BSPDIR}/sources/meta-boot2qt/meta-fsl-extras \
+  ${BSPDIR}/sources/meta-mingw \
+  ${BSPDIR}/sources/meta-qt5 \
+  ${BSPDIR}/sources/meta-bsp-imx8mq \
+  "
diff --git a/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8x.sample b/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8x.sample
new file mode 100644
index 00000000..169f3eb5
--- /dev/null
+++ b/meta-boot2qt-distro/conf/bblayers.conf.cl-som-imx8x.sample
@@ -0,0 +1,56 @@
+############################################################################
+##
+## Copyright (C) 2018 The Qt Company Ltd.
+## Contact: https://www.qt.io/licensing/
+##
+## This file is part of the Boot to Qt meta layer.
+##
+## $QT_BEGIN_LICENSE:GPL$
+## Commercial License Usage
+## Licensees holding valid commercial Qt licenses may use this file in
+## accordance with the commercial license agreement provided with the
+## Software or, alternatively, in accordance with the terms contained in
+## a written agreement between you and The Qt Company. For licensing terms
+## and conditions see https://www.qt.io/terms-conditions. For further
+## information use the contact form at https://www.qt.io/contact-us.
+##
+## GNU General Public License Usage
+## Alternatively, this file may be used under the terms of the GNU
+## General Public License version 3 or (at your option) any later version
+## approved by the KDE Free Qt Foundation. The licenses are as published by
+## the Free Software Foundation and appearing in the file LICENSE.GPL3
+## included in the packaging of this file. Please review the following
+## information to ensure the GNU General Public License requirements will
+## be met: https://www.gnu.org/licenses/gpl-3.0.html.
+##
+## $QT_END_LICENSE$
+##
+############################################################################
+
+# POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf
+# changes incompatibly
+POKY_BBLAYERS_CONF_VERSION = "2"
+
+BBPATH = "${TOPDIR}"
+BBFILES ?= ""
+BSPDIR := "${@os.path.abspath(os.path.dirname(d.getVar('FILE')) + '/../..')}"
+
+BBLAYERS ?= " \
+  ${BSPDIR}/sources/poky/meta \
+  ${BSPDIR}/sources/poky/meta-poky \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-bsp \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-sdk \
+  ${BSPDIR}/sources/meta-freescale \
+  ${BSPDIR}/sources/meta-freescale-3rdparty \
+  ${BSPDIR}/sources/meta-openembedded/meta-oe \
+  ${BSPDIR}/sources/meta-openembedded/meta-python \
+  ${BSPDIR}/sources/meta-openembedded/meta-networking \
+  ${BSPDIR}/sources/meta-openembedded/meta-initramfs \
+  ${BSPDIR}/sources/meta-openembedded/meta-multimedia \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt-distro \
+  ${BSPDIR}/sources/meta-boot2qt/meta-fsl-extras \
+  ${BSPDIR}/sources/meta-mingw \
+  ${BSPDIR}/sources/meta-qt5 \
+  ${BSPDIR}/sources/meta-cl-som-imx8x \
+  "
diff --git a/meta-boot2qt-distro/conf/bblayers.conf.ucm-imx8m-mini.sample b/meta-boot2qt-distro/conf/bblayers.conf.ucm-imx8m-mini.sample
new file mode 100644
index 00000000..02342d4e
--- /dev/null
+++ b/meta-boot2qt-distro/conf/bblayers.conf.ucm-imx8m-mini.sample
@@ -0,0 +1,56 @@
+############################################################################
+##
+## Copyright (C) 2018 The Qt Company Ltd.
+## Contact: https://www.qt.io/licensing/
+##
+## This file is part of the Boot to Qt meta layer.
+##
+## $QT_BEGIN_LICENSE:GPL$
+## Commercial License Usage
+## Licensees holding valid commercial Qt licenses may use this file in
+## accordance with the commercial license agreement provided with the
+## Software or, alternatively, in accordance with the terms contained in
+## a written agreement between you and The Qt Company. For licensing terms
+## and conditions see https://www.qt.io/terms-conditions. For further
+## information use the contact form at https://www.qt.io/contact-us.
+##
+## GNU General Public License Usage
+## Alternatively, this file may be used under the terms of the GNU
+## General Public License version 3 or (at your option) any later version
+## approved by the KDE Free Qt Foundation. The licenses are as published by
+## the Free Software Foundation and appearing in the file LICENSE.GPL3
+## included in the packaging of this file. Please review the following
+## information to ensure the GNU General Public License requirements will
+## be met: https://www.gnu.org/licenses/gpl-3.0.html.
+##
+## $QT_END_LICENSE$
+##
+############################################################################
+
+# POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf
+# changes incompatibly
+POKY_BBLAYERS_CONF_VERSION = "2"
+
+BBPATH = "${TOPDIR}"
+BBFILES ?= ""
+BSPDIR := "${@os.path.abspath(os.path.dirname(d.getVar('FILE')) + '/../..')}"
+
+BBLAYERS ?= " \
+  ${BSPDIR}/sources/poky/meta \
+  ${BSPDIR}/sources/poky/meta-poky \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-bsp \
+  ${BSPDIR}/sources/meta-fsl-bsp-release/imx/meta-sdk \
+  ${BSPDIR}/sources/meta-freescale \
+  ${BSPDIR}/sources/meta-freescale-3rdparty \
+  ${BSPDIR}/sources/meta-openembedded/meta-oe \
+  ${BSPDIR}/sources/meta-openembedded/meta-python \
+  ${BSPDIR}/sources/meta-openembedded/meta-networking \
+  ${BSPDIR}/sources/meta-openembedded/meta-initramfs \
+  ${BSPDIR}/sources/meta-openembedded/meta-multimedia \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt \
+  ${BSPDIR}/sources/meta-boot2qt/meta-boot2qt-distro \
+  ${BSPDIR}/sources/meta-boot2qt/meta-fsl-extras \
+  ${BSPDIR}/sources/meta-mingw \
+  ${BSPDIR}/sources/meta-qt5 \
+  ${BSPDIR}/sources/meta-bsp-imx8mm \
+  "
diff --git a/scripts/setup-environment.sh b/scripts/setup-environment.sh
index 529971e6..707397f8 100755
--- a/scripts/setup-environment.sh
+++ b/scripts/setup-environment.sh
@@ -60,7 +60,7 @@ if [ ! -f ${PWD}/${BUILDDIRECTORY}/conf/bblayers.conf ]; then
       LAYERSCONF="bblayers.conf.fsl-imx8.sample"
     ;;
     cl-som-imx8|ucm-imx8m-mini|cl-som-imx8x)
-      LAYERSCONF="bblayers.conf.fsl-imx8.sample"
+      LAYERSCONF="bblayers.conf.${MACHINE}.sample"
     ;;
     apalis-imx8|colibri-imx8qxp)
       LAYERSCONF="bblayers.conf.toradex-imx8.sample"
-- 
2.11.0

